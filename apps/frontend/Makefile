.PHONY: deploy build-local

DEPLOY_SERVERS ?= ktb-fe01
DEPLOY_PATH ?= /home/ubuntu/ktb-chat-frontend

build-local:
	@echo "ğŸ—ï¸  Building locally..."
	npm run build:production
	@echo "âœ… Local build completed!"

deploy:
	@echo "ğŸ“¦ Deploying to remote servers..."
	@for server in $(DEPLOY_SERVERS); do \
	   echo "â†’ Deploying to $$server..."; \
	   ssh -o StrictHostKeyChecking=no ubuntu@$$server "mkdir -p $(DEPLOY_PATH)"; \
	   echo "  ğŸ“ Copying standalone build..."; \
	   rsync -avz --delete --exclude='*.log' --exclude='.env*' --exclude="server.pid" \
	      -e "ssh -o StrictHostKeyChecking=no" \
	      .next/standalone/ ubuntu@$$server:$(DEPLOY_PATH)/; \
	   echo "  âœ… Deployment to $$server completed!"; \
	done